{"version":3,"file":"Add-b27efb84.js","sources":["../../../resources/ts/src/containers/Backend/Manager/Roles/Add.jsx"],"sourcesContent":["import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { withRouter } from 'react-router-dom';\r\nimport { FormGroup, CustomInput } from 'reactstrap';\r\n\r\n// Components\r\nimport Save from '../../../../components/Backend/UI/Form/Save';\r\n\r\nimport Input from '../../../../components/UI/Input';\r\nimport Preloader from '../../../../components/UI/Preloaders/Preloader';\r\n\r\nimport actions from '../../../../store/actions/backend/roles';\r\nimport * as utility from '../utility';\r\n\r\nconst initialState = {\r\n    name: '',\r\n    description: '',\r\n    features: [],\r\n\r\n    add: false,\r\n}\r\n\r\nclass Add extends Component {\r\n    state = { ...initialState, isMounted: false }\r\n\r\n    // Component methods\r\n    resetState = () => this.setState({ ...initialState })\r\n    saveAddHandler = () => utility.add.component.saveAddHandler(this.setState.bind(this), this.props)\r\n    inputChangeHandler = e => {\r\n        const { id, name, value, checked, files } = e.target;\r\n        if (name.includes('features')) {\r\n            let features = [...this.state.features];\r\n\r\n            if (name.includes('id')) {\r\n                const [, feature_id] = id.split('-');\r\n                const feature = features.find(f => +f.id === +feature_id);\r\n\r\n                if (checked && !feature) features.push({ id: feature_id, permissions: [] });\r\n                else features = features.filter(f => +f.id !== +feature_id);\r\n            } else if (name.includes('permissions')) {\r\n                const [, feature_id, abbr] = id.split('-');\r\n                const featureIndex = features.findIndex(f => +f.id === +feature_id);\r\n                const feature = features[featureIndex];\r\n                let permissions = [...feature.permissions];\r\n                const found = permissions.includes(abbr);\r\n\r\n                if (checked && !found) permissions.push(abbr);\r\n                else permissions = permissions.filter(p => p !== abbr);\r\n\r\n                feature.permissions = permissions;\r\n                features[featureIndex] = feature;\r\n            }\r\n\r\n            return this.setState({ features });\r\n        }\r\n        this.setState({ [name]: files ? files[0] : value });\r\n    }\r\n\r\n    // Lifecycle methods\r\n    componentDidMount() { utility.add.lifecycle.componentDidMount(this.props, this.setState.bind(this)) }\r\n    componentDidUpdate(prevProps) { utility.add.lifecycle.componentDidUpdate('roles', 'role')(prevProps, this.props, this.state, this.setState.bind(this), this.resetState) }\r\n    componentWillUnmount() { this.props.reset() }\r\n    render() {\r\n        const {\r\n            content: {\r\n                cms: {\r\n                    pages: { backend: { pages: { roles: { form } } } }\r\n                }\r\n            },\r\n            backend: { roles: { features = [] } },\r\n        } = this.props;\r\n        const { name, description, features: f } = this.state;\r\n\r\n        const featuresItems = features.sort((a, b) => a.name.localeCompare(b.name)).map(feature => {\r\n            const element = f.find(i => +i.id === +feature.id);\r\n\r\n            const permissions = [{ abbr: 'c', name: form.create }, { abbr: 'u', name: form.update }, { abbr: 'd', name: form.delete }].map(p => {\r\n                const checked = element && element.permissions.includes(p.abbr);\r\n\r\n                return <div key={JSON.stringify(p)} className='col-lg-4'>\r\n                    <FormGroup>\r\n                        <CustomInput type=\"checkbox\" id={`feature-${feature.id}-${p.abbr}`} checked={checked} name={`features[${feature.id}][permissions][${p.abbr}]`} onChange={this.inputChangeHandler} label={p.name} />\r\n                    </FormGroup>\r\n                </div>\r\n            });\r\n\r\n            const checked = element !== undefined;\r\n\r\n            return <div key={JSON.stringify(feature)}>\r\n                <CustomInput type=\"switch\" id={`feature-${feature.id}`} className=\"col-12 pb-2\" checked={checked} name={`features[${feature.id}][id]`} onChange={this.inputChangeHandler} label={<span className=\"text-500\">{feature.name}</span>} />\r\n\r\n                {checked && <div className='row'>{permissions}</div>}\r\n            </div>\r\n        });\r\n\r\n        const content = <>\r\n            {this.props.edit && <input type=\"hidden\" name=\"_method\" defaultValue=\"PATCH\" />}\r\n\r\n            <div className='row'>\r\n                <div className=\"col-lg-9\">\r\n                    <div className='row'>\r\n                        <Input type=\"text\" className=\"col-md-6\" onChange={this.inputChangeHandler} value={name} name=\"name\" required label={form.name} />\r\n                        <Input type=\"text\" className=\"col-md-6\" onChange={this.inputChangeHandler} value={description} name=\"description\" required label={form.description} />\r\n\r\n                        <div className=\"pb-2 col-12 text-large text-700\">{form.features}</div>\r\n                        <FormGroup className=\"col-12\">\r\n                            {featuresItems}\r\n                        </FormGroup>\r\n                    </div>\r\n                </div>\r\n\r\n                <Save edit={this.props.edit} saveAddHandler={this.saveAddHandler} />\r\n            </div>\r\n        </>;\r\n\r\n        return <utility.add.lifecycle.render className='Roles' props={this.props} state={this.state} resource={'roles'}>\r\n            {content}\r\n        </utility.add.lifecycle.render>;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => ({ ...state });\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n    get: id => dispatch(actions.show(id)),\r\n    info: () => dispatch(actions.info()),\r\n    post: data => dispatch(actions.post(data)),\r\n    patch: (id, data) => dispatch(actions.patch(id, data)),\r\n    reset: () => dispatch(actions.reset()),\r\n});\r\n\r\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(Add));"],"names":["initialState","Add","Component","__publicField","utility.add","id","name","value","checked","files","features","feature_id","feature","f","abbr","featureIndex","permissions","found","p","prevProps","form","description","featuresItems","a","b","element","i","jsx","FormGroup","CustomInput","content","jsxs","Fragment","Input","Save","mapStateToProps","state","mapDispatchToProps","dispatch","actions","data","Add$1","withRouter","connect"],"mappings":"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"}