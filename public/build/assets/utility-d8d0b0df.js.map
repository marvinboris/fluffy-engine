{"version":3,"file":"utility-d8d0b0df.js","sources":["../../../resources/ts/src/containers/Backend/Manager/utility.jsx"],"sourcesContent":["import React from 'react';\r\nimport { Redirect } from 'react-router-dom';\r\n\r\nimport Loading from '../../../components/UI/Preloaders/Loading';\r\n\r\nimport Error from '../../../components/Messages/Error';\r\nimport Feedback from '../../../components/Messages/Feedback';\r\n\r\nimport Form from '../../../components/Backend/UI/Form';\r\nimport List from '../../../components/Backend/UI/List';\r\n\r\nimport PageTitle from '../../../components/Backend/UI/Title/PageTitle';\r\nimport Breadcrumb from '../../../components/Backend/UI/Title/Breadcrumb';\r\n\r\nconst readURL = input => {\r\n    if (input.files && input.files[0]) {\r\n        const file = input.files[0];\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = function (e) {\r\n            document.getElementById(`embed-${input.name}`).style.backgroundImage = `url('${e.target.result}')`;\r\n            document.getElementById(`embed-${input.name}`).style.backgroundSize = \"cover\";\r\n            document.getElementById(`embed-${input.name}`).querySelector(\".file-selected\").innerHTML = file.name;\r\n        }\r\n\r\n        reader.readAsDataURL(file); // convert to base64 string\r\n    }\r\n};\r\n\r\nconst saveHandler = props => e => {\r\n    e.preventDefault();\r\n    if (props.edit) props.patch(props.match.params.id, e.target);\r\n    else props.post(e.target);\r\n};\r\n\r\nconst Redirection = ({ props, resource }) => {\r\n    const {\r\n        auth: { role, data }\r\n    } = props;\r\n\r\n    if (role === 'user') {\r\n        const feature = data.role.features.find(f => f.prefix === resource.split('_').join('-'));\r\n        return !(feature && JSON.parse(feature.permissions).includes(props.edit ? 'u' : 'c')) ? <Redirect to=\"/user/dashboard\" /> : null;\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\nexport const add = {\r\n    component: {\r\n        saveAddHandler: (setState, props) => () => setState({ add: true }, () => props.post(document.querySelector('form'))),\r\n        inputChangeHandler: (state, setState) => e => {\r\n            const { name, value, files } = e.target;\r\n            if (files) readURL(e.target);\r\n            if (name.includes('[')) {\r\n                const { translate } = state;\r\n                const stateName = name.split('[')[0];\r\n                const element = state[stateName];\r\n                element[translate] = value;\r\n                return setState({ [stateName]: element });\r\n            }\r\n            setState({ [name]: files ? files[0] : value });\r\n        },\r\n        fileUpload: id => document.getElementById(id).click(),\r\n    },\r\n    lifecycle: {\r\n        componentDidMount: (props, setState) => {\r\n            props.reset();\r\n            if (props.edit) props.get(props.match.params.id);\r\n            else if (props.info) props.info();\r\n            setState({ isMounted: true });\r\n        },\r\n        componentDidUpdate: (resource, singular) => (prevProps, props, state, setState, resetState) => {\r\n            if (!prevProps.backend[resource].message && props.backend[resource].message && props.backend[resource].message.type === 'success' && !props.edit) {\r\n                if (state.add) resetState();\r\n                else props.history.push({\r\n                    pathname: `/${props.auth.role}/${resource.split('_').join('-')}`,\r\n                    state: {\r\n                        message: props.backend[resource].message,\r\n                    },\r\n                });\r\n            }\r\n            if ((!prevProps.backend[resource][singular] && props.backend[resource][singular]) || (props.edit && !prevProps.backend[resource].message && props.backend[resource].message && props.backend[resource].message.type === 'success')) {\r\n                const { backend: { [resource]: { [singular]: item } } } = props;\r\n                setState({ ...item });\r\n            }\r\n        },\r\n        render: ({ className, props, state, resource, children }) => {\r\n            const {\r\n                content: {\r\n                    cms: {\r\n                        pages: { backend: { pages: { [resource]: cms } } }\r\n                    }\r\n                },\r\n                backend: { [resource]: { loading, error, message } },\r\n                auth: { role }\r\n            } = props;\r\n\r\n            if (!state.isMounted) document.title = `${props.edit ? cms.edit : cms.add} | ${document.head.querySelector('meta[name=\"base-title\"]').content}`;\r\n\r\n            return <div className={className}>\r\n                <PageTitle title={cms.title} subtitle={props.edit ? cms.edit : cms.add} icon={cms.icon}>\r\n                    <Breadcrumb items={props.edit && [{ to: `/${role}/${resource.split('_').join('-')}`, content: cms.index }]} main={props.edit ? cms.edit : cms.add} />\r\n                </PageTitle>\r\n\r\n                <Loading loading={state.isMounted && loading} isAuthenticated>\r\n                    <div className='content'>\r\n                        <Redirection props={props} resource={resource} />\r\n                        <Feedback message={message} />\r\n                        <Error err={error} />\r\n                        <Form onSubmit={saveHandler(props)} icon={cms.icon} title={props.edit ? cms.edit : cms.add} list={cms.index} link={`/${role}/${resource.split('_').join('-')}`} innerClassName=\"row justify-content-center\">\r\n                            {children}\r\n                        </Form>\r\n                    </div>\r\n                </Loading>\r\n            </div>\r\n        }\r\n    }\r\n};\r\n\r\nexport const index = {\r\n    lifecycle: {\r\n        render: ({ className, props, state, resource, data, fields }) => {\r\n            const {\r\n                content: {\r\n                    cms: {\r\n                        pages: { backend: { pages: { [resource]: cms } } }\r\n                    }\r\n                },\r\n                backend: { [resource]: { loading, error, message, [resource]: items = [], total } },\r\n                auth: { role }\r\n            } = props;\r\n\r\n            if (!state.isMounted) document.title = `${cms.index} | ${document.head.querySelector('meta[name=\"base-title\"]').content}`;\r\n\r\n            return <div className={className}>\r\n                <PageTitle title={cms.title} subtitle={cms.index} icon={cms.icon}>\r\n                    <Breadcrumb main={cms.index} />\r\n                </PageTitle>\r\n\r\n                <Loading loading={state.isMounted && loading} isAuthenticated>\r\n                    <div className='content'>\r\n                        <Error err={error} />\r\n                        {props.location.state ? <Feedback time={5000} message={props.location.state.message} /> : null}\r\n                        <Feedback message={message} />\r\n                        <List array={data} loading={loading} data={JSON.stringify(items)} get={props.get} total={total} bordered add={cms.add} link={`/${role}/${resource.split('_').join('-')}/add`} icon={cms.icon} title={cms.index} className=\"shadow-sm\" fields={fields} />\r\n                    </div>\r\n                </Loading>\r\n            </div>;\r\n        }\r\n    }\r\n}"],"names":["readURL","input","file","reader","e","saveHandler","props","Redirection","resource","role","data","feature","f","Redirect","add","setState","state","name","value","files","translate","stateName","element","id","singular","prevProps","resetState","item","className","children","cms","loading","error","message","jsxs","jsx","PageTitle","Breadcrumb","Loading","Feedback","Error","Form","index","fields","items","total","List"],"mappings":"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"}